<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kSQL">
	<!-- 대륙 조회 질의명령 -->
	<select id="getContinent" resultType="kVO">
		select
			distinct(continent)
		from
			city
	</select>
	<select id="getCountry" resultType="kVO" parameterType="String">
		select
			distinct(country)
		from
			city
		where
			continent = #{continent}
	</select>
	<select id="getCity" resultType="kVO" parameterType="kVO">
		select
			cityname
		from
			city
		where
			continent = #{continent}
            AND country = #{country}
	</select>
	<!-- 날짜와 도시로 조회 -->
	<select id="cityDate" resultType="kVO">
	    SELECT
	        *
	    FROM
	        kpreddata
	    WHERE
	        city = '서울'
	        AND kdate = TRUNC(SYSDATE)
	</select>
	<!-- 테마파크로 해당도시 조회 -->
	<select id="parkCityDate" resultType="kVO" parameterType="kVO">
	    SELECT
	        *
	    FROM
	        kpreddata
	    WHERE
	        city = #{city}
	        AND kdate = TRUNC(SYSDATE)
	</select>
	<!-- 도시 조회 -->
	<select id="selCity" resultType="kVO">
		select
			distinct(city) city
		from
			kpreddata
		order by
			city
	</select>
	<!-- 도시, 날짜 선택 후 조회 -->
	<select id="selCityDate" resultType="kVO" parameterType="kVO">
   		select
			*
		from
			kpreddata k, accuracy_score a
		where
			k.city = a.city
            AND a.city = #{city}
            AND kdate = to_date(#{kdate})
	</select>
	<select id="selAccu" resultType="kVO">
		select
			*
		from
			accuracy_score
		where
			city = '서울'
	</select>
	<select id="accCity" resultType="kVO" parameterType="kVO">
		select
			*
		from
			accuracy_score
		where
			city = #{city}
	</select>
	
	<select id="accRank" resultType="kVO">
		select arate, city, rank from (	
		select arate, city, rownum rank from(           
		select
		    round((KPM25+KPM10+KO3+KCO+KNO2+KSO2) / 6) arate, city, rownum rno
		from
		    accuracy_score
		order by
		    arate desc)
		)
		where rank between 1 and 5
	</select>
	<select id="dateRank" resultType="kVO" parameterType="String">
		select rno, city, kdate, predicted_pm10 from
		    (
		    select rownum rno, city, kdate, predicted_pm10 from
		        (
		            select
		                city, kdate, predicted_pm10
		            from
		                kpreddata
		            where
		                kdate = to_date(#{kdate})
		            order by
		                to_number(predicted_pm10)
		        )
		    )
		where rno between 1 and 5
	</select>
</mapper>