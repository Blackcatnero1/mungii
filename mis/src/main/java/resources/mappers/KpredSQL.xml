<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kSQL">
	
	<!-- 도시 조회하는 질의명령 -->
	<select id="selCity" resultType="kVO">
		select
			distinct(city) city
		from
			kpreddata
		order by
			city
	</select>

	<!-- 도시, 날짜 선택 후 조회 -->
	<select id="selCityDate" resultType="kVO" parameterType="kVO">
   		select
			*
		from
			kpreddata k, accuracy_score a
		where
			k.city = a.city
            AND a.city = #{city}
            AND kdate = to_date(#{kdate})
	</select>
	
	<!-- 도시 입력 후 해당 도시의 예측 데이터의 예측률 가져오는 질의명령 -->
	<select id="accCity" resultType="kVO" parameterType="String">
		select
			*
		from
			accuracy_score
		where
			city = #{city}
	</select>
	
	<!-- 현재까지의 데이터 예측률 순위를 보여주는 질의명령 -->
	<select id="accRank" resultType="kVO">
		select arate, city, rank from (	
		select arate, city, rownum rank from(           
		select
		    round((KPM25+KPM10) / 2) arate, city, rownum rno
		from
		    accuracy_score
		order by
		    arate desc)
		)
		where rank between 1 and 5
	</select>
	
	<!-- 선택한 날짜의 미세먼지 순위를 나타내는 질의명령 -->
	<select id="dateRank" resultType="kVO" parameterType="String">
		select rno, city, kdate, predicted_pm10 from
		    (
		    select rownum rno, city, kdate, predicted_pm10 from
		        (
		            select
		                city, kdate, predicted_pm10
		            from
		                kpreddata
		            where
		                kdate = to_date(#{kdate})
		            order by
		                to_number(predicted_pm10)
		        )
		    )
		where rno between 1 and 5
	</select>
</mapper>